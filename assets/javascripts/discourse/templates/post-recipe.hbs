{{post-gap post=this postStream=controller.postStream before="true"}}

<div class='row'>
  {{view 'reply-history' content=replyHistory}}
</div>

<article {{bind-attr class=":boxed via_email" id="postElementId" data-post-id="id" data-user-id="user_id"}}>
  <div class='row'>
    <div class='topic-body part-view'>
      <div {{bind-attr class=":select-posts controller.multiSelect::hidden"}}>
        <button {{action "toggledSelectedPostReplies" this}} {{bind-attr class="view.canSelectReplies::hidden"}}>{{i18n 'topic.multi_select.select_replies'}}</button>
        <button {{action "toggledSelectedPost" this}} class="select-post">{{view.selectPostText}}</button>
      </div>

      <!-- keep the classes here in sync with composer.hbs -->
      <div {{bind-attr class="showUserReplyTab:avoid-tab view.repliesShown::bottom-round :contents :regular view.extraClass"}}>
        <div class='cooked post-box'>
          {{{cooked}}}
        </div>

        {{#if controller.hasLanguages }}
          <article class='post-box'>
            <h2>{{i18n 'recipes.language'}}</h2>
            <div class="row">
              {{#each group in controller.groupedLanguages}}
                  <div class="span4">
                    <ul class="plain-list">
                      {{#each language in group}}
                        <li>{{language.value}}</li>
                      {{/each}}
                    </ul>
                  </div>
              {{/each}}
            </div>
          </article>
        {{/if}}

        {{#if controller.hasTechnologies }}
          <article class='post-box'>
            <h2>{{i18n 'recipes.technology'}}</h2>
            <div class="row">
              {{#each group in controller.groupedTechnologies}}
                  <div class="span4">
                    <ul class="plain-list">
                      {{#each language in group}}
                        <li>{{language.value}}</li>
                      {{/each}}
                    </ul>
                  </div>
              {{/each}}
            </div>
          </article>
        {{/if}}

        <article class='post-box'>
          <div class="row">
            <div class="span8">
              <h2>{{i18n 'recipes.author'}}</h2>
              <p>
                {{#link-to 'user' username}}{{username}}{{/link-to}}
              </p>
            </div>
          </div>
        </article>

        <hr>

        {{#if cooked_hidden}}
          <a href {{action "expandHidden" this}}>{{i18n 'post.show_hidden'}}</a>
        {{/if}}
        {{#if view.showExpandButton}}
          {{#if controller.loadingExpanded}}
            <button class="btn expand-post" disabled>{{i18n 'loading'}}</button>
          {{else}}
            <button {{action "expandFirstPost" this}} class='btn expand-post'>{{i18n 'post.show_full'}}&hellip;</button>
          {{/if}}
        {{/if}}
        {{view 'post-recipe-menu' post=this}}
      </div>

      {{discourse-action-history post=this}}
      {{view 'topic-map-container' post=this topic=controller.model}}
    </div>
  </div>

</article>

{{post-gap post=this postStream=controller.postStream before="false"}}
